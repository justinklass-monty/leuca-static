(()=>{var e={};e.id=374,e.ids=[374],e.modules={496:()=>{},846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3648:()=>{},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6044:(e,t,r)=>{"use strict";e.exports=r(4870)},8758:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>j,routeModule:()=>O,serverHooks:()=>N,workAsyncStorage:()=>q,workUnitAsyncStorage:()=>C});var s={};r.r(s),r.d(s,{POST:()=>k});var i=r(6044),a=r(3409),n=r(9576);let o=require("node:buffer"),l=require("node:crypto"),d=require("node:net");var u=["draft-6","draft-7","draft-8"],c=(e,t)=>{let r;return e?r=Math.max(0,Math.ceil((e.getTime()-Date.now())/1e3)):t&&(r=Math.ceil(t/1e3)),r},p=e=>{let t=(0,l.createHash)("sha256");t.update(e);let r=t.digest("hex").slice(0,12);return o.Buffer.from(r).toString("base64")},h=(e,t)=>{!e.headersSent&&(e.setHeader("X-RateLimit-Limit",t.limit.toString()),e.setHeader("X-RateLimit-Remaining",t.remaining.toString()),t.resetTime instanceof Date&&(e.setHeader("Date",new Date().toUTCString()),e.setHeader("X-RateLimit-Reset",Math.ceil(t.resetTime.getTime()/1e3).toString())))},m=(e,t,r)=>{if(e.headersSent)return;let s=Math.ceil(r/1e3),i=c(t.resetTime);e.setHeader("RateLimit-Policy",`${t.limit};w=${s}`),e.setHeader("RateLimit-Limit",t.limit.toString()),e.setHeader("RateLimit-Remaining",t.remaining.toString()),i&&e.setHeader("RateLimit-Reset",i.toString())},f=(e,t,r)=>{if(e.headersSent)return;let s=Math.ceil(r/1e3),i=c(t.resetTime,r);e.setHeader("RateLimit-Policy",`${t.limit};w=${s}`),e.setHeader("RateLimit",`limit=${t.limit}, remaining=${t.remaining}, reset=${i}`)},w=(e,t,r,s,i)=>{if(e.headersSent)return;let a=Math.ceil(r/1e3),n=c(t.resetTime,r),o=p(i),l=`q=${t.limit}; w=${a}; pk=:${o}:`,d=`r=${t.remaining}; t=${n}`;e.append("RateLimit-Policy",`"${s}"; ${l}`),e.append("RateLimit",`"${s}"; ${d}`)},y=(e,t,r)=>{if(e.headersSent)return;let s=c(t.resetTime,r);e.setHeader("Retry-After",s.toString())},g=class extends Error{constructor(e,t){let r=`https://express-rate-limit.github.io/${e}/`;super(`${t} See ${r} for more information.`),this.name=this.constructor.name,this.code=e,this.help=r}},R=class extends g{},v=new Set,E=new WeakMap,_={enabled:{default:!0},disable(){for(let e of Object.keys(this.enabled))this.enabled[e]=!1},ip(e){if(void 0===e)throw new g("ERR_ERL_UNDEFINED_IP_ADDRESS","An undefined 'request.ip' was detected. This might indicate a misconfiguration or the connection being destroyed prematurely.");if(!(0,d.isIP)(e))throw new g("ERR_ERL_INVALID_IP_ADDRESS",`An invalid 'request.ip' (${e}) was detected. Consider passing a custom 'keyGenerator' function to the rate limiter.`)},trustProxy(e){if(!0===e.app.get("trust proxy"))throw new g("ERR_ERL_PERMISSIVE_TRUST_PROXY","The Express 'trust proxy' setting is true, which allows anyone to trivially bypass IP-based rate limiting.")},xForwardedForHeader(e){if(e.headers["x-forwarded-for"]&&!1===e.app.get("trust proxy"))throw new g("ERR_ERL_UNEXPECTED_X_FORWARDED_FOR","The 'X-Forwarded-For' header is set but the Express 'trust proxy' setting is false (default). This could indicate a misconfiguration which would prevent express-rate-limit from accurately identifying users.")},positiveHits(e){if("number"!=typeof e||e<1||e!==Math.round(e))throw new g("ERR_ERL_INVALID_HITS",`The totalHits value returned from the store must be a positive integer, got ${e}`)},unsharedStore(e){if(v.has(e)){let t=e?.localKeys?"":" (with a unique prefix)";throw new g("ERR_ERL_STORE_REUSE",`A Store instance must not be shared across multiple rate limiters. Create a new instance of ${e.constructor.name}${t} for each limiter instead.`)}v.add(e)},singleCount(e,t,r){let s=E.get(e);s||(s=new Map,E.set(e,s));let i=t.localKeys?t:t.constructor.name,a=s.get(i);a||(a=[],s.set(i,a));let n=`${t.prefix??""}${r}`;if(a.includes(n))throw new g("ERR_ERL_DOUBLE_COUNT",`The hit count for ${r} was incremented more than once for a single request.`);a.push(n)},limit(e){if(0===e)throw new R("WRN_ERL_MAX_ZERO","Setting limit or max to 0 disables rate limiting in express-rate-limit v6 and older, but will cause all requests to be blocked in v7")},draftPolliHeaders(e){if(e)throw new R("WRN_ERL_DEPRECATED_DRAFT_POLLI_HEADERS","The draft_polli_ratelimit_headers configuration option is deprecated and has been removed in express-rate-limit v7, please set standardHeaders: 'draft-6' instead.")},onLimitReached(e){if(e)throw new R("WRN_ERL_DEPRECATED_ON_LIMIT_REACHED","The onLimitReached configuration option is deprecated and has been removed in express-rate-limit v7.")},headersDraftVersion(e){if("string"!=typeof e||!u.includes(e)){let e=u.join(", ");throw new g("ERR_ERL_HEADERS_UNSUPPORTED_DRAFT_VERSION",`standardHeaders: only the following versions of the IETF draft specification are supported: ${e}.`)}},headersResetTime(e){if(!e)throw new g("ERR_ERL_HEADERS_NO_RESET","standardHeaders:  'draft-7' requires a 'resetTime', but the store did not provide one. The 'windowMs' value will be used instead, which may cause clients to wait longer than necessary.")},validationsConfig(){let e=Object.keys(this).filter(e=>!["enabled","disable"].includes(e));for(let t of(e.push("default"),Object.keys(this.enabled)))if(!e.includes(t))throw new g("ERR_ERL_UNKNOWN_VALIDATION",`options.validate.${t} is not recognized. Supported validate options are: ${e.join(", ")}.`)},creationStack(e){let{stack:t}=Error("express-rate-limit validation check (set options.validate.creationStack=false to disable)");if(t?.includes("Layer.handle [as handle_request]")){if(!e.localKeys)throw new g("ERR_ERL_CREATED_IN_REQUEST_HANDLER","express-rate-limit instance should *usually* be created at app initialization, not when responding to a request.");throw new g("ERR_ERL_CREATED_IN_REQUEST_HANDLER","express-rate-limit instance should be created at app initialization, not when responding to a request.")}}},b=e=>{let t;let r={enabled:t="boolean"==typeof e?{default:e}:{default:!0,...e}};for(let[e,s]of Object.entries(_))"function"==typeof s&&(r[e]=(...i)=>{if(t[e]??t.default)try{s.apply(r,i)}catch(e){e instanceof R?console.warn(e):console.error(e)}});return r},S=class{constructor(){this.previous=new Map,this.current=new Map,this.localKeys=!0}init(e){this.windowMs=e.windowMs,this.interval&&clearInterval(this.interval),this.interval=setInterval(()=>{this.clearExpired()},this.windowMs),this.interval.unref&&this.interval.unref()}async get(e){return this.current.get(e)??this.previous.get(e)}async increment(e){let t=this.getClient(e),r=Date.now();return t.resetTime.getTime()<=r&&this.resetClient(t,r),t.totalHits++,t}async decrement(e){let t=this.getClient(e);t.totalHits>0&&t.totalHits--}async resetKey(e){this.current.delete(e),this.previous.delete(e)}async resetAll(){this.current.clear(),this.previous.clear()}shutdown(){clearInterval(this.interval),this.resetAll()}resetClient(e,t=Date.now()){return e.totalHits=0,e.resetTime.setTime(t+this.windowMs),e}getClient(e){let t;return this.current.has(e)?this.current.get(e):(this.previous.has(e)?(t=this.previous.get(e),this.previous.delete(e)):(t={totalHits:0,resetTime:new Date},this.resetClient(t)),this.current.set(e,t),t)}clearExpired(){this.previous=this.current,this.current=new Map}},T=e=>"function"==typeof e.incr&&"function"!=typeof e.increment,x=e=>{if(!T(e))return e;class t{async increment(t){return new Promise((r,s)=>{e.incr(t,(e,t,i)=>{e&&s(e),r({totalHits:t,resetTime:i})})})}async decrement(t){return e.decrement(t)}async resetKey(t){return e.resetKey(t)}async resetAll(){if("function"==typeof e.resetAll)return e.resetAll()}}return new t},H=e=>{let{validations:t,...r}=e;return{...r,validate:t.enabled}},L=e=>{let t={};for(let r of Object.keys(e))void 0!==e[r]&&(t[r]=e[r]);return t},P=e=>{let t=L(e),r=b(t?.validate??!0);r.validationsConfig(),r.draftPolliHeaders(t.draft_polli_ratelimit_headers),r.onLimitReached(t.onLimitReached);let s=t.standardHeaders??!1;!0===s&&(s="draft-6");let i={windowMs:6e4,limit:e.max??5,message:"Too many requests, please try again later.",statusCode:429,legacyHeaders:e.headers??!0,identifier(e,t){let r="",{limit:s}=e[i.requestPropertyName],a=i.windowMs/1e3,n=i.windowMs/6e4,o=i.windowMs/36e5,l=i.windowMs/864e5;return r=a<60?`${a}sec`:n<60?`${n}min`:o<24?`${o}hr${o>1?"s":""}`:`${l}day${l>1?"s":""}`,`${s}-in-${r}`},requestPropertyName:"rateLimit",skipFailedRequests:!1,skipSuccessfulRequests:!1,requestWasSuccessful:(e,t)=>t.statusCode<400,skip:(e,t)=>!1,keyGenerator:(e,t)=>(r.ip(e.ip),r.trustProxy(e),r.xForwardedForHeader(e),e.ip),async handler(e,t,r,s){t.status(i.statusCode);let a="function"==typeof i.message?await i.message(e,t):i.message;t.writableEnded||t.send(a)},passOnStoreError:!1,...t,standardHeaders:s,store:x(t.store??new S),validations:r};if("function"!=typeof i.store.increment||"function"!=typeof i.store.decrement||"function"!=typeof i.store.resetKey||void 0!==i.store.resetAll&&"function"!=typeof i.store.resetAll||void 0!==i.store.init&&"function"!=typeof i.store.init)throw TypeError("An invalid store was passed. Please ensure that the store is a class that implements the `Store` interface.");return i},A=e=>async(t,r,s)=>{try{await Promise.resolve(e(t,r,s)).catch(s)}catch(e){s(e)}},I=e=>{let t=P(e??{}),r=H(t);t.validations.creationStack(t.store),t.validations.unsharedStore(t.store),"function"==typeof t.store.init&&t.store.init(r);let s=A(async(e,s,i)=>{let a;if(await t.skip(e,s)){i();return}let n=await t.keyGenerator(e,s),o=0;try{let e=await t.store.increment(n);o=e.totalHits,a=e.resetTime}catch(e){if(t.passOnStoreError){console.error("express-rate-limit: error from store, allowing request without rate-limiting.",e),i();return}throw e}t.validations.positiveHits(o),t.validations.singleCount(e,t.store,n);let l="function"==typeof t.limit?t.limit(e,s):t.limit,d=await l;t.validations.limit(d);let u={limit:d,used:o,remaining:Math.max(d-o,0),resetTime:a};if(Object.defineProperty(u,"current",{configurable:!1,enumerable:!1,value:o}),e[t.requestPropertyName]=u,t.legacyHeaders&&!s.headersSent&&h(s,u),t.standardHeaders&&!s.headersSent)switch(t.standardHeaders){case"draft-6":m(s,u,t.windowMs);break;case"draft-7":t.validations.headersResetTime(u.resetTime),f(s,u,t.windowMs);break;case"draft-8":{let r="function"==typeof t.identifier?t.identifier(e,s):t.identifier,i=await r;t.validations.headersResetTime(u.resetTime),w(s,u,t.windowMs,i,n);break}default:t.validations.headersDraftVersion(t.standardHeaders)}if(t.skipFailedRequests||t.skipSuccessfulRequests){let r=!1,i=async()=>{r||(await t.store.decrement(n),r=!0)};t.skipFailedRequests&&(s.on("finish",async()=>{await t.requestWasSuccessful(e,s)||await i()}),s.on("close",async()=>{s.writableEnded||await i()}),s.on("error",async()=>{await i()})),t.skipSuccessfulRequests&&s.on("finish",async()=>{await t.requestWasSuccessful(e,s)&&await i()})}if(t.validations.disable(),o>d){(t.legacyHeaders||t.standardHeaders)&&y(s,u,t.windowMs),t.handler(e,s,i,r);return}i()});return s.resetKey=t.store.resetKey.bind(t.store),s.getKey="function"==typeof t.store.get?t.store.get.bind(t.store):()=>{throw Error("The current store does not support the get/getKey method")},s};I({windowMs:9e5,max:100,message:{error:"Too many requests from this IP, please try again later."},standardHeaders:!0,legacyHeaders:!1}),I({windowMs:9e5,max:5,message:{error:"Too many form submissions from this IP, please try again later."},standardHeaders:!0,legacyHeaders:!1});let $=I({windowMs:36e5,max:3,message:{error:"Too many subscription attempts from this IP, please try again later."},standardHeaders:!0,legacyHeaders:!1});class D{logEvent(e){let t={...e,timestamp:new Date().toISOString()};this.events.push(t),this.events.length>this.maxEvents&&(this.events=this.events.slice(-this.maxEvents))}logRateLimit(e,t,r){this.logEvent({type:"rate_limit",source:e,details:"Rate limit exceeded",ip:t,userAgent:r})}logInvalidInput(e,t,r,s){this.logEvent({type:"invalid_input",source:e,details:t,ip:r,userAgent:s})}logSuspiciousActivity(e,t,r,s){this.logEvent({type:"suspicious_activity",source:e,details:t,ip:r,userAgent:s})}logError(e,t,r,s){this.logEvent({type:"error",source:e,details:t,ip:r,userAgent:s})}getRecentEvents(e=50){return this.events.slice(-e)}getEventsByType(e){return this.events.filter(t=>t.type===e)}clearEvents(){this.events=[]}constructor(){this.events=[],this.maxEvents=1e3}}let M=new D;async function k(e){try{await new Promise((t,r)=>{$(e,{status:()=>({send:r})},t)});let{email:t}=await e.json();if(!t)return new Response(JSON.stringify({error:"Email required"}),{status:400,headers:{"Content-Type":"application/json"}});if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t))return M.logInvalidInput("subscribe_api",`Invalid email format: ${t}`,e.headers.get("x-forwarded-for")||e.headers.get("x-real-ip"),e.headers.get("user-agent")),new Response(JSON.stringify({error:"Invalid email format"}),{status:400,headers:{"Content-Type":"application/json"}});let r=t.trim().toLowerCase(),s=process.env.KIT_API_KEY;if(!s)return console.error("KIT_API_KEY not configured"),new Response(JSON.stringify({error:"Service temporarily unavailable"}),{status:500,headers:{"Content-Type":"application/json"}});let i=await fetch("https://api.kit.com/v4/subscribers",{method:"POST",headers:{"X-Kit-Api-Key":s,"Content-Type":"application/json"},body:JSON.stringify({email_address:r,state:"active"})}),a=await i.json();if(!i.ok)return console.error("Kit API error:",a),new Response(JSON.stringify({error:"Subscription failed. Please try again later."}),{status:400,headers:{"Content-Type":"application/json"}});return new Response(JSON.stringify({success:!0,message:"Successfully subscribed to newsletter"}),{status:201,headers:{"Content-Type":"application/json"}})}catch(t){if(console.error("Subscribe API error:",t),t.message&&t.message.includes("Too many"))return M.logRateLimit("subscribe_api",e.headers.get("x-forwarded-for")||e.headers.get("x-real-ip"),e.headers.get("user-agent")),new Response(JSON.stringify({error:t.message}),{status:429,headers:{"Content-Type":"application/json"}});return new Response(JSON.stringify({error:"Internal server error. Please try again later."}),{status:500,headers:{"Content-Type":"application/json"}})}}let O=new i.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/subscribe/route",pathname:"/api/subscribe",filename:"route",bundlePath:"app/api/subscribe/route"},resolvedPagePath:"/Users/justinklass/leuca/leuca-v0/app/api/subscribe/route.js",nextConfigOutput:"",userland:s}),{workAsyncStorage:q,workUnitAsyncStorage:C,serverHooks:N}=O;function j(){return(0,n.patchFetch)({workAsyncStorage:q,workUnitAsyncStorage:C})}},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[576],()=>r(8758));module.exports=s})();